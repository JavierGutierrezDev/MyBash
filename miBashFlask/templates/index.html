<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Mi Shell Interactiva</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
    /* Paleta pastel oscuro */
    body {
      background: linear-gradient(135deg, #334e68, #47376a);
      color: #e0e0e0;
    }
    .btn {
      transition: transform .2s ease, box-shadow .2s ease;
    }
    .btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 .3rem .6rem rgba(0,0,0,0.6);
    }
    .card {
      background-color: #4f6272;
      border: none;
      border-radius: .75rem;
      transition: transform .3s ease, box-shadow .3s ease;
    }
    .card:hover {
      transform: translateY(-8px) scale(1.02);
      box-shadow: 0 .5rem 1rem rgba(0,0,0,0.6);
    }
    #output {
      background-color: #2f3640;
      border-radius: .5rem;
      color: #d1e8e2;
      white-space: pre-wrap;
      height: 400px;
      overflow: auto;
    }
    /* Spinner color */
    .spinner-border {
      color: #a5c9ca;
    }
  </style>
</head>
<body class="bg-light">

  <div class="container py-4">
    <h1 class="text-center mb-4">Mi Shell Interactiva</h1>

    <!-- Botones de comando -->
    <div class="row mb-4">
      <div class="col-12 d-flex flex-wrap justify-content-center gap-2">
        <button class="btn btn-dark" onclick="run('help')">Ayuda</button>
        <button class="btn btn-secondary" onclick="window.location.href='/showAbout'">Acerca</button>
        <button class="btn btn-info" onclick="promptRun('clima','Ciudad para el clima:')">Clima</button>
        <button class="btn btn-secondary" onclick="promptRun('alias','Comando alias (ej: ls -l):')">Alias</button>
        <button class="btn btn-warning" onclick="run('show_date')">Fecha / Hora</button>
        <button class="btn btn-primary" onclick="window.location.href='/game/guess'">Adivina Número</button>
        <button class="btn btn-outline-primary" onclick="promptRun('install_app','Paquete a instalar:')">Instalar</button>
        <button class="btn btn-outline-danger" onclick="promptRun('uninstall_app','Paquete a desinstalar:')">Desinstalar</button>
        <button class="btn btn-danger" onclick="promptRun('kill_process','PID a matar:')">Matar Proceso</button>
        <button class="btn btn-warning" onclick="promptRun('show_pid','PID a mostrar info:')">Mostrar PID</button>
      </div>
    </div>

    <!-- Conversión de imagen a ASCII -->
    <div class="row mb-4">
      <div class="col-12 col-md-6 offset-md-3">
        <div class="card shadow-sm">
          <div class="card-header text-center">Convertir Imagen a ASCII</div>
          <div class="card-body text-center">
            <input id="fileInput" type="file" accept="image/*" class="form-control mb-3">
            <button id="asciiBtn" class="btn btn-outline-secondary w-100">Convertir</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Spinner global -->
    <div id="spinner" class="text-center mb-3 d-none">
      <div class="spinner-border" role="status"><span class="visually-hidden">Cargando...</span></div>
    </div>

    <!-- Área de salida -->
    <div class="row">
      <div class="col">
        <pre id="output"
             class="bg-dark text-white p-3 rounded"
             style="height:400px; overflow:auto; white-space: pre-wrap;"></pre>
      </div>
    </div>
  </div>

  <!-- Modal Space Invaders -->
  <div class="modal fade" id="modalSpace" tabindex="-1" aria-labelledby="modalSpaceLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalSpaceLabel">Space Invaders</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <p>Para jugar Space Invaders en tu terminal:</p>
          <pre>ninvaders</pre>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    function showSpinner(on) {
      document.getElementById('spinner').classList.toggle('d-none', !on);
    }

    function run(cmd, args = []) {
      showSpinner(true);
      document.getElementById('output').textContent = '';
      fetch('/run', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ comando: cmd, args: args })
      })
      .then(r => r.json())
      .then(data => {
        showSpinner(false);
        console.log(cmd, data.output);
        document.getElementById('output').textContent = data.output;
      })
      .catch(err => {
        showSpinner(false);
        console.error(cmd, err);
        document.getElementById('output').textContent = 'Error: ' + err;
      });
    }

    function promptRun(cmd, message) {
      const val = prompt(message);
      if (!val && message.indexOf('(no hace falta')===-1) return;
      const args = val ? val.trim().split(/\s+/) : [];
      run(cmd, args);
    }

    document.getElementById('asciiBtn').addEventListener('click', () => {
      const file = document.getElementById('fileInput').files[0];
      if (!file) return alert('Selecciona una imagen primero.');
      showSpinner(true);
      const form = new FormData();
      form.append('image', file);
      fetch('/ascii', { method: 'POST', body: form })
        .then(r => r.json())
        .then(data => {
          showSpinner(false);
          console.log('ascii', data.output);
          document.getElementById('output').textContent = data.output;
        })
        .catch(err => {
          showSpinner(false);
          console.error('ascii', err);
          document.getElementById('output').textContent = 'Error: ' + err;
        });
    });
  </script>
</body>
</html>
